
{% extends 'base.html'%}
{% load static %}
{% block content %}
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Jobs</title>
<link rel="stylesheet" href="{% static 'css/authenticated.css'%}">
<link rel="stylesheet" href="{% static 'css/jobs.css'%}">
<link rel="stylesheet" href="{% static 'css/profile-header.css'%}">
<link rel="stylesheet" href="{% static 'css/posted-jobs-media-queries.css'%}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<div class="jobs-buttons">
    <div class="mutual-padding-of-div plus-div">
        <img style="cursor: pointer;" title="Search a Job" id="search-img" class="plus-icon-jobs search-icon-jobs" src="{% static 'img/search.png' %}" alt="">
        <form method="get" action="{% url 'home' %}" >
        <div class="mutual-padding-of-div input-search-div" style="border-radius: 20px;">
            <input  name="q" placeholder="Search by job or location" id="search-input" class="search-input" style="padding: 8px 30px; padding-left: 20px; background-color: white;display:none;            ">
         </div>
        </form>
    </div>
     <form method="get" action="{% url 'filter' %}">
        <div class="mutual-padding-of-div plus-div">
            <select class="" name="program">
                <option selected><a href="">{{fprogram}}</a></option>
                {% for i in prog %}
                <option value="{{i}}">{{i}}</option>
                {%endfor%}
                                <option value="Rinor">Rinor</option>

            </select>
        </div>
        <div class="mutual-padding-of-div plus-div">
            <select class="" name="title">
                    <option>{{ftitle}}</option>
                {% for i in title %}
                <option value="{{i}}">{{i}}</option>
                {%endfor%}
            </select>
        </div>
    <div class="mutual-padding-of-div plus-div">
            <select class=" outline-none" name="company">
                <option>{{fcompany}}</option>
                {% for i in company %}
                <option value="{{i}}">{{i}}</option>
                {% endfor %}
            </select>
        </div>
    <div class="mutual-padding-of-div plus-div">
                <select class=" outline-none" name="location">
                    <option>{{flocation}}</option>
                    {% for i in city %}
                        <option value="{{i}}">{{i}}</option>
                    {% endfor %}
                </select>
            </div>
    <div class="mutual-padding-of-div plus-div">
                <select class="" name="salary">
                    <option>{{fsalary}}</option>
                    {% for i in salary %}
                <option value="{{i}}">{{i}}$</option>
                {%endfor%}
                </select>
            </div>
    <div class="mutual-padding-of-div plus-div">
                <select class="" name="dataPosted">
                    <option>Date Posted</option>
                    <option>Today</option>
                    <option>Last Week</option>
                    <option>Last Month</option>
                </select>
            </div>
        <button type="submit" class="applied-button-jobs outline-none" style="text-decoration:none;margin-top: 5px; width: fit-content; padding-top: 8px; padding-bottom: 8px;">Find</button>
</form>

    </div>

{% if stat %}

<div class="jobs-main-div"  style="display: flex; justify-content: space-between; width: 100%;">




        <div class="jobs-left" style="" id="myDIV">
             {% for i in job %}
                    <div onclick="getNumber({{i.id}},{{i.total_applicant}})" class="jobs-rows-img second-jobs margin-top-jobs-rows-img same-background-jobs pixel"  id="select{{i.id}}">
                        <img class="experience-education-img" src="{{i.logo.url}}" alt="">
                        <span class="experience-rows">
                        <span class="experience-first-row">{{i.job_title}}</span>
                        <span class="experience-second-row">{{i.company}}</span>
                        <span class="experience-third-row">{{i.city_j}}, {{i.city_j.country}}</span>
                        <span class="experience-fourth-row">{{i.program}}</span>
                        <span class="experience-fourth-row">{{i.start_date|date:'F'}}</span>

                        </span>
                    </div>
                    <span class="move"></span>
            {% endfor %}
            {% for j in jobi %}
                    <div onclick="getNumber({{j.id}})" class="jobs-rows-img second-jobs margin-top-jobs-rows-img same-background-jobs pixel"  id="select{{j.id}}">
                        <img class="experience-education-img" src="{{j.logo.url}}" alt="">
                        <span class="experience-rows">
                            <span class="experience-first-row">{{j.job_title}}</span>
                            <span class="experience-second-row">{{j.company}}</span>
                            <span class="experience-third-row">{{j.city_j}}, {{j.city_j.country}}</span>
                            <span class="experience-fourth-row">{{j.program}}</span>
                        </span>
                    </div>
                    <span class="move"></span>
            {% endfor %}
    </div>
    <div class="right-jobs-main-div">
            <div class="right-jobs" id="detailsRow" style="flex-direction: column;">
                <div class="right-jobs-rows-img" style="padding: 30px; margin-left: 10px; background-color: white;">
                    <div class="experience-rows">
                    <img class="exit-job-description" title="Exit" style="float: left; width: 22px; height: 22px;" src="{% static 'img/Vector 81 (1).png'%}" alt="">
                    <div class="first-row-jobs">
                <p class="" id="job_title"></p>
            </div>
            <div class="second-row-jobs"><span id="company"></span>&nbsp;&nbsp;<span style="color: #858585;"
                    id="city"> &nbsp;&nbsp;</span><span id="countApplicant" style="color:gray"></span></div>
            <div style="" class="experience-third-row jobs-third-row"><span id="salary">{{jobi.salary_per_hour}}</span></div>
            <div style="" class="experience-fourth-row jobs-mutual-margin-rows"><span id="typeOfWork"></span>
                <span id="hourPerWork"></span>
            </div>
            <div style="margin-top: 20px;" class="experience-fourth-row jobs-mutual-margin-rows" id="sDate">
            </div>
            <div style="margin-top: 5px; margin-top: 20px;" class="experience-fourth-row jobs-mutual-margin-rows">
                <span id="housing">{{ jobi.housing}}</span><span id="housingCost">{{ jobi.housing_cost_per_week}}</span>
            </div>
            <div style="margin-top: 5px; margin-top: 20px;" class="experience-fourth-row jobs-mutual-margin-rows">
                <span id="§">{{jobi.program}}</span><span id="programCost">{{jobi.programCost}}</span>
            </div>

                        <div id="button"  style="margin-top:25px">
                        </div>
                    </div>
                </div>
                <div class="right-jobs-rows-img-second">
                    <div class="col-5">
                        <textarea rows="50" cols="100" id="message" class="scroll" disabled>
                        </textarea>
                    </div>
                </div>
            </div>
</div>
    {% else %}

<link rel="stylesheet" href="{% static 'css/404.css'%}">

        <div id="notfound">
            <div class="notfound">
                <h1 class="h" >Oops! we cannot find the job <br>
                                You where looking for !</h1>
                <div class="notfound-404">
                    <img src="{% static 'img/oopss.png'%}">
                </div>
                <br>
                <br>
                <br>
                <br>
                <br>
                <p class="p">Pleas choice your filter careful and we are gonna show the best job for you</p>
                <input name="submit" type="submit" class="sign-in-submit-input font-fam" value="Go Back" onClick="history.go(-1);">
            </div>
        </div>
{% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<script src="{% static 'js/exit-job-description-button.js'%}"></script>
<script>
    async function getNumber(id,appplicants) {


        var elements = document.getElementsByClassName('pixel'); // get all elements

        for(var i = 0; i < elements.length; i++){
            elements[i].style.backgroundColor = "white";
        }

        post_id=id


        console.log("post__id="+post_id)
        let response = await fetch('',{

            method: "get",

            headers: {
                "X-Requested-With": "XMLHttpRequest",
                "Content-Type": 'application/json',
                text: post_id,
            }

        }

        )

        let data = await response.json()

        var element = document.getElementById("detailsRow");

        if (element) {
            var display = element.style.display;

            if (display == "none") {
                element.style.display = "block";
            }
        }
        if(id != 0){
            var select = document.getElementById('select'+id)
            select.style.backgroundColor = "#E7F1FE";
        }

        if(id == 0){
            id=data["post_id"]
            var select = document.getElementById('select'+id)
            select.style.backgroundColor = "#E7F1FE";
        }


        let textarea = document.getElementById('message')
        textarea.value = ""
        textarea.value += data["description"]


        var element = document.getElementById("job_title");
        element.innerHTML = data["title"]

        var city_jobs = document.getElementById("city")
        city_jobs.innerHTML = data ["city_j"]+",  "+data["country"]

        if(appplicants != null){

        var countApplicant = document.getElementById("countApplicant")
        countApplicant.innerHTML = " · "+appplicants+"  -  Applicant"
        }else{
            var countApplicant = document.getElementById("countApplicant")
        countApplicant.innerHTML = " ·  "+data["applicant"]+"  -  Applicant"
        }

        var start_date = document.getElementById("sDate")
        start_date.innerHTML = data["start_date"]+" - "+data["end_date"]

        var company = document.getElementById("company")
        company.innerHTML = data["company"]

        var salary = document.getElementById("salary")
        salary.innerHTML ="$"+ data ["salary"]+"/hour"

        var typeOfWork = document.getElementById('typeOfWork')
        typeOfWork.innerHTML = data["typeOfWork"]

        var hourPerWork = document.getElementById('hourPerWork')
        hourPerWork.innerHTML = " · "+data['hourPerWork']+" hours/week"

        var housing = document.getElementById("housing")
        housing.innerHTML = "Housing "+data['housing']

        var housingCost = document.getElementById("housingCost")
        housingCost.innerHTML = " ·  $"+data["housingCost"]+"/week"

        var program = document.getElementById('program')
        program.innerHTML = data["program"]

        var programCost = document.getElementById("programCost")
        programCost.innerHTML = "· Program Cost: $"+data["programCost"]
        var button = document.getElementById("button")
        var url= "apply/"+id
        button.innerHTML = '{% if user.profileSetup %}<a href="'+url+'" class="applied-button-jobs outline-none" style="text-decoration:none;margin-top: 5px; width: fit-content; padding-top: 8px; padding-bottom: 8px;">Fast Apply</a>{% else %}<a href="'+url+'" class="applied-button-jobs outline-none" style="text-decoration:none;margin-top: 5px; width: fit-content; padding-top: 8px; padding-bottom: 8px;">Apply</a>{% endif %}';


        var firstMediaQuery = window.matchMedia('(min-width: 768px');
        const mediaQuery = window.matchMedia('(max-width: 767px)');
        var right_jobs_main_div = document.querySelector('.right-jobs-main-div');
        var jobs_left = document.querySelector('.jobs-left');
        var jobs_buttons = document.querySelector('.jobs-buttons');

        if (mediaQuery.matches) {
                right_jobs_main_div.style.display = "block";
                jobs_left.style.display = "none";
                jobs_buttons.style.display = "none";
                if(id==0){
                var select = document.getElementById('select'+id)
                select.style.backgroundColor = "white";
                }
        }
        ;
    }


        var nul = "";

        var firstMediaQuery = window.matchMedia('(min-width: 768px');
        const mediaQuery = window.matchMedia('(max-width: 767px)');
        var right_jobs_main_div = document.querySelector('.right-jobs-main-div');
        var jobs_left = document.querySelector('.jobs-left');
        var jobs_buttons = document.querySelector('.jobs-buttons');

        if (mediaQuery.matches) {
                right_jobs_main_div.style.display = "none";
                jobs_left.style.display = "block";
                jobs_buttons.style.display = "block";
                if(id==0){
                var select = document.getElementById('select'+id)
                select.style.backgroundColor = "white";
                }
        };
        window.onload = getNumber(nul);

</script>

<script src="{% static 'js/Jobs/searchButton.js' %}">

</script>
{% endblock content%}